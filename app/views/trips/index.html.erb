<h1><%= link_to "Trips", trips_path %></h1>
<table>
  <tr>
    <th>Car</th>
    <th>Date</th>
    <th class=numeric>Start Odometer</th>
    <th class=numeric>End Odometer</th>
    <th>Start Location</th>
    <th>End Location</th>
    <th class=numeric>Distance</th>
    <th>Driver</th>
  <tr>
<% @trips.each do |trip| %>
<% # if this is the first trip %>
  <% first_trip = Trip.where(car_id: trip.car).order(:id).first.id == trip.id %>
  <% if first_trip %>
    <% distance = trip.odo %>
    <% last_id = "-" %>
  <% else %>
    <% distance = trip.odo - trip.last_trip.odo %>
    <% last_id = trip.last_trip.id %>
  <% end %>

  <tr>
    <td><%= link_to trip.car.name, trips_path(:car => trip.car) %></td>
    <td><%= trip.date.strftime('%d/%m/%Y') %></td>
    <% if first_trip %>
      <td class=numeric>-</td>
    <% else %>
      <td class=numeric><%= Trip.find(last_id).odo %>
    <% end %>
    <td class=numeric><%= trip.odo %></td>
    <% if first_trip %>
      <td>-</td>
    <% else %>
      <td><%= Trip.find(last_id).location %>
    <% end %>
    <td><%= trip.location %>
    <td class=numeric><%= distance %></td>
    <td><%= trip.user.name %></td>
<% end %>
</table>
<% if @trips.size == 0 %>
  <em>No trips found</em><br />
<% end %>
<% if params[:car] %>
  <%= link_to "Log new trip for " + Car.where(id: params[:car]).last.name, new_trip_path(:car => params[:car]), class: "button" %>
<% end %>
