<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Ben Formosa 11429074" />
  <title>Fleet Manager User Guide</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; }
code > span.dt { color: #204a87; }
code > span.dv { color: #0000cf; }
code > span.bn { color: #0000cf; }
code > span.fl { color: #0000cf; }
code > span.ch { color: #4e9a06; }
code > span.st { color: #4e9a06; }
code > span.co { color: #8f5902; font-style: italic; }
code > span.ot { color: #8f5902; }
code > span.al { color: #ef2929; }
code > span.fu { color: #000000; }
code > span.er { font-weight: bold; }
  </style>
  
  
  
  
</head>
<body>
<div id="header">
<h1 class="title">Fleet Manager User Guide</h1>
<h2 class="author">Ben Formosa 11429074</h2>
</div>
<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#concepts">Concepts</a><ul>
<li><a href="#users">Users</a></li>
<li><a href="#administrators">Administrators</a></li>
<li><a href="#cars">Cars</a></li>
<li><a href="#trips">Trips</a></li>
</ul></li>
<li><a href="#other-notes">Other notes</a><ul>
<li><a href="#units-of-measurement">Units of measurement</a></li>
<li><a href="#licensing">Licensing</a></li>
</ul></li>
</ul></li>
<li><a href="#installation">Installation</a><ul>
<li><a href="#overview">Overview</a><ul>
<li><a href="#database">Database</a></li>
<li><a href="#terms">Terms</a></li>
</ul></li>
<li><a href="#requirements">Requirements</a><ul>
<li><a href="#directory-server">Directory server</a></li>
</ul></li>
<li><a href="#installing-fleet-manager">Installing Fleet Manager</a><ul>
<li><a href="#installing-fleet-manager-with-the-installer">Installing Fleet Manager with the installer</a></li>
<li><a href="#installing-fleet-manager-manually">Installing Fleet Manager manually</a></li>
</ul></li>
<li><a href="#configuring-fleet-manager">Configuring Fleet Manager</a><ul>
<li><a href="#configuring-ldap">Configuring LDAP</a></li>
<li><a href="#set-up-database">Set up Database</a></li>
<li><a href="#configuring-https">Configuring HTTPS</a></li>
</ul></li>
<li><a href="#maintaining-fleet-manager">Maintaining Fleet Manager</a><ul>
<li><a href="#starting-fleet-manager">Starting Fleet Manager</a></li>
<li><a href="#stopping-fleet-manager">Stopping Fleet Manager</a></li>
<li><a href="#restarting-fleet-manager">Restarting Fleet Manager</a></li>
<li><a href="#checking-if-fleet-manager-is-running">Checking if Fleet Manager is running</a></li>
<li><a href="#backing-up-fleet-manager">Backing up Fleet Manager</a></li>
<li><a href="#restoring-from-backup">Restoring from backup</a></li>
</ul></li>
<li><a href="#uninstalling-fleet-manager">Uninstalling Fleet Manager</a><ul>
<li><a href="#uninstalling-fleet-manager-with-the-uninstaller">Uninstalling Fleet Manager with the uninstaller</a></li>
<li><a href="#uninstalling-fleet-manager-manually">Uninstalling Fleet Manager manually</a></li>
</ul></li>
<li><a href="#troubleshooting">Troubleshooting</a><ul>
<li><a href="#log-files">Log files</a></li>
<li><a href="#troubleshooting-running-application">Troubleshooting running application</a></li>
</ul></li>
</ul></li>
<li><a href="#using-fleet-manager">Using Fleet Manager</a><ul>
<li><a href="#navigating-fleet-manager">Navigating Fleet Manager</a><ul>
<li><a href="#signing-in-to-fleet-manager">Signing in to Fleet Manager</a></li>
<li><a href="#logging-out-of-fleet-manager">Logging out of Fleet Manager</a></li>
</ul></li>
<li><a href="#managing-cars">Managing cars</a><ul>
<li><a href="#adding-a-car">Adding a car</a></li>
<li><a href="#viewing-a-cars-details">Viewing a car’s details</a></li>
<li><a href="#editing-a-car">Editing a car</a></li>
<li><a href="#disabling-a-car.">Disabling a car.</a></li>
</ul></li>
<li><a href="#logging-travel">Logging travel</a><ul>
<li><a href="#logging-garaged-cars">Logging garaged cars</a></li>
<li><a href="#logging-personal-travel">Logging personal travel</a></li>
</ul></li>
<li><a href="#viewing-trips">Viewing trips</a></li>
<li><a href="#reports">Reports</a></li>
</ul></li>
</ul>
</div>
<!---

pandoc fm-user-guide.md -f markdown+auto_identifiers+definition_lists --smart -V papersize:"a4paper" --table-of-contents --toc-depth=3 --standalone --highlight-style tango -o fm-user-guide.pdf \
&& \
pandoc fm-user-guide.md -f markdown+auto_identifiers+definition_lists --smart --table-of-contents --toc-depth=3 --self-contained --standalone --highlight-style tango -o fm-user-guide.html

-->

<h1 id="introduction"><a href="#introduction">Introduction</a></h1>
<p>Fleet Manager (FM) is a web-based system for recording travel. You can use it to track mileage in multiple vehicles for multiple drivers.</p>
<h2 id="concepts"><a href="#concepts">Concepts</a></h2>
<h3 id="users"><a href="#users">Users</a></h3>
<p>Each driver should track their own travel. Fleet Manager uses your existing user directory to allow drivers to sign in to Fleet Manager with their own usernames and passwords.<br />Users can log travel as well as add and manage their own cars</p>
<h3 id="administrators"><a href="#administrators">Administrators</a></h3>
<p>Some users should be assigned the role of administrator, which allows them to add and modify any car.</p>
<h3 id="cars"><a href="#cars">Cars</a></h3>
<p>Each vehicle has its profile stored. This includes information about the car, such as its make, model and registration. Each car must be assigned a unique name.</p>
<h4 id="fleet-cars"><a href="#fleet-cars">Fleet cars</a></h4>
<p>If a car belongs to the company, it is a fleet car.</p>
<h4 id="disabled-cars"><a href="#disabled-cars">Disabled cars</a></h4>
<p>Once a car is no longer being used, it should be marked as disabled. This won’t delete the car or any data, but will hide it from most views.</p>
<h3 id="trips"><a href="#trips">Trips</a></h3>
<p>Each journey from one destination to another is referred to as a trip. This is recorded in Fleet Manager by entering the destination and the odometer reading of the car on arrival.</p>
<h4 id="garaging-cars"><a href="#garaging-cars">Garaging cars</a></h4>
<p>If a car is kept overnight at an employee’s residence, it is garaged there.</p>
<h4 id="personal-travel"><a href="#personal-travel">Personal travel</a></h4>
<p>If a trip is not for business purposes, it is a personal trip. If your businesses charges employees for personal travel in company vehicles, you can use this to produce a list of charges.</p>
<h2 id="other-notes"><a href="#other-notes">Other notes</a></h2>
<h3 id="units-of-measurement"><a href="#units-of-measurement">Units of measurement</a></h3>
<p>The odometer reading and distance measurements do not include any units, and no calculations or conversions assume a particular unit of measurement. You should ensure that all data entered uses a consistent unit of measurement.</p>
<h3 id="licensing"><a href="#licensing">Licensing</a></h3>
<p>Fleet Manager is free software, released under the MIT License. It includes other free software such as Ruby on Rails, without all of which this project would not exist.</p>
<h1 id="installation"><a href="#installation">Installation</a></h1>
<p>Fleet Manager is a <a href="http://rubyonrails.org/">Ruby on Rails</a> application hosted with <a href="https://www.phusionpassenger.com/">Phusion Passenger Standalone</a>, which can be installed on many operating systems. The recommended way to install Fleet Manager is on a dedicated Debian or Ubuntu GNU/Linux computer.</p>
<h2 id="overview"><a href="#overview">Overview</a></h2>
<p>You can install Fleet Manager using an <a href="#installing-fleet-manager-with-the-installer">installer</a> or <a href="#installing-fleet-manager-manually">manually</a>. The installer only supports some operating systems.</p>
<h3 id="database"><a href="#database">Database</a></h3>
<p>Fleet Manager stores all data in a SQLite3 database, <code>db/production.sqlite3</code> under the app directory.</p>
<h3 id="terms"><a href="#terms">Terms</a></h3>
<dl>
<dt><strong>FM</strong></dt>
<dd>Fleet Manager
</dd>
<dt><strong>App directory</strong></dt>
<dd>The directory in which Fleet Manager is installed, e.g. <code>/srv/rails/fm</code>
</dd>
</dl>
<h2 id="requirements"><a href="#requirements">Requirements</a></h2>
<ul>
<li>Create a new user to install and run Fleet Manager.</li>
<li>Install Ruby 1.8.5 or higher.</li>
<li>LDAP <a href="#directory-server">Directory server</a></li>
</ul>
<h3 id="directory-server"><a href="#directory-server">Directory server</a></h3>
<p>Fleet Manager requires a directory server to provide user authentication. This could be openLDAP, Microsoft Active Directory, Novell eDirectory or other LDAP-compatible directory. Fleet Manager must be able to communicate with the Directory server using LDAP.<br />It is recommended to create a directory user for Fleet Manager to use to bind to the directory.</p>
<h2 id="installing-fleet-manager"><a href="#installing-fleet-manager">Installing Fleet Manager</a></h2>
<h3 id="installing-fleet-manager-with-the-installer"><a href="#installing-fleet-manager-with-the-installer">Installing Fleet Manager with the installer</a></h3>
<p>The installer is a script which does the following:</p>
<ul>
<li>Adds the Phusion Passenger apt repository and installs Phusion Passenger.</li>
<li>Creates a user ‘fm’.</li>
<li>Creates a self-signed certificate for the web server.</li>
<li>Creates an init script.</li>
<li>Installs ruby and prerequisite software from apt.</li>
<li>Installs bundler using gem</li>
<li>Clones the Fleet Manager source from GitHub</li>
<li>Installs required software using bundler</li>
<li>Configures a secret key for the application</li>
</ul>
<p>To install Fleet Manager on Debian or Ubuntu:</p>
<ol style="list-style-type: decimal">
<li><p>Download and run the script. You will be prompted for your sudo password.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">wget</span> https://raw.githubusercontent.com/benformosa/fm/master/install/install.sh
<span class="kw">chmod</span> +x install.sh
<span class="kw">./install.sh</span></code></pre></li>
<li><p>Configure the application. See <a href="#configuring-fleet-manager">Configuring Fleet Manager</a>.<br />Edit <code>config/ldap.yml</code> under the app directory.</p></li>
<li><p>Set up the database. See <a href="#set-up-database">Set up Database</a>.<br />Run the script <code>install/setupdb.sh</code> under the app directory.</p></li>
<li><p>Start the application.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">/etc/init.d/fm</span> start</code></pre></li>
</ol>
<h3 id="installing-fleet-manager-manually"><a href="#installing-fleet-manager-manually">Installing Fleet Manager manually</a></h3>
<p>To install Fleet Manager on non-Debian based systems:</p>
<ol style="list-style-type: decimal">
<li><p>Create a user to install and run FM as. E.g. <code>fm</code>.<br />Set this user’s home directory to the app directory and add them to the sudoers group.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> useradd --user-group fm --home-dir /srv/rails/fm --shell /bin/bash --groups sudo</code></pre></li>
<li><p>Create the app directory, and change its owner to <code>fm</code>.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> mkdir -p /srv/rails/fm
<span class="kw">sudo</span> chown fm:fm /srv/rails/fm</code></pre></li>
<li><p>Install <code>passenger</code> and <code>bundler</code> using <code>gem</code></p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> gem install passenger
<span class="kw">sudo</span> gem install bundler</code></pre></li>
<li><p>Become user <code>fm</code>.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> su -l fm</code></pre></li>
<li>As <code>fm</code>, copy the FM source files into the app directory.<br />You can either a download a zip archive and extract it here, or clone the project from GitHub.</li>
<li><p>As <code>fm</code>, install the software required by FM using bundler.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">bundle</span> install</code></pre></li>
<li><p>As <code>fm</code>, pre-compile static files. This prepares images, css and js to be delivered by the web server.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">RAILS_ENV=</span>production <span class="kw">bundle</span> exec rake assets:precompile</code></pre></li>
<li><p>Return to your normal user shell.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">exit</span></code></pre></li>
<li><p>Set the <code>secret_key_base</code> in the file <code>config/initializers/secret_token.rb</code> under the app directory.<br />This is used for securely storing session information. See the <a href="http://guides.rubyonrails.org/security.html#session-storage">Ruby on Rails Security Guide</a></p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">echo</span> <span class="st">&quot;fm::Application.config.secret_key_base = \</span>
<span class="st">  </span><span class="dt">\&quot;</span><span class="ot">$(</span><span class="kw">cd</span> /srv/rails/fm <span class="kw">&amp;&amp;</span> <span class="kw">bundle</span> exec rake secret<span class="ot">)</span><span class="dt">\&quot;</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="kw">\</span>
  <span class="kw">sudo</span> tee /srv/rails/fm/config/initializers/secret_token.rb <span class="kw">&gt;</span> /dev/null</code></pre></li>
<li><p>Copy the initscript and config file to <code>/etc</code> and set as executable.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> cp /srv/rails/fm/install/initd-fm /etc/init.d/fm
<span class="kw">sudo</span> chmod +x /etc/init.d/fm
<span class="kw">sudo</span> cp /srv/rails/fm/install/etc-fm.sh /etc/fm.sh
<span class="kw">sudo</span> chmod +x /etc/fm.sh</code></pre></li>
<li><p>Obtain or generate an SSL certificate. E.g.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">openssl</span> req -x509 -newkey rsa:2048 -days 365 -nodes \
  <span class="kw">-keyout</span> /etc/ssl/private/self-signed.key -out /etc/ssl/certs/self-signed.pem 
<span class="kw">sudo</span> chmod 600 /etc/ssl/certs/self-signed.pem
<span class="kw">sudo</span> chmod 600 /etc/ssl/private/self-signed.key</code></pre></li>
<li><p>Configure the application. See <a href="#configuring-fleet-manager">Configuring Fleet Manager</a>.<br />Edit <code>config/ldap.yml</code> under the app directory.</p></li>
<li><p>Set up the database. See <a href="#set-up-database">Set up Database</a>.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> /srv/rails/fm/install/setupdb.sh<span class="kw">`</span></code></pre></li>
<li><p>Start the application.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">/etc/init.d/fm</span> start</code></pre></li>
</ol>
<h2 id="configuring-fleet-manager"><a href="#configuring-fleet-manager">Configuring Fleet Manager</a></h2>
<p>Configuration for the service is through the configuration file <code>/etc/fm.sh</code>. This is a shell script which only sets variables.<br />Configuration for the application itself is through configuration files in <code>config</code>, under the app directory.</p>
<h3 id="configuring-ldap"><a href="#configuring-ldap">Configuring LDAP</a></h3>
<p>It is essential to configure LDAP settings before setting up the database.</p>
<p>The file <code>config/ldap.yml</code> under the app directory defines FM’s connection to an LDAP server.</p>
<p>Set the following values in the <strong><code>authorizations</code></strong> section:</p>
<dl>
<dt><code>group_base</code></dt>
<dd>Base OU to search for groups.
</dd>
<dt><code>required_groups</code></dt>
<dd>Array with the first item being the LDAP attribute name which records group members, and the second being the Distinguished Name of the group containing all FM users.
</dd>
<dt><code>admin_group</code></dt>
<dd>Array with the first item being the LDAP attribute name which records group members, and the second being the Distinguished Name of the group containing all FM <a href="#administrators">administrators</a>.
</dd>
</dl>
<p>Set the following values in the <strong><code>production</code></strong> section:</p>
<dl>
<dt><code>host</code></dt>
<dd>LDAP server hostname or IP address.
</dd>
<dt><code>port</code></dt>
<dd>TCP port the LDAP service is listening on.
</dd>
<dt><code>attribute</code></dt>
<dd>Name of the LDAP attribute that users will enter in the login field. For AD, this is usually <code>samaccountname</code>, for openLDAP; it’s usually <code>cn</code>.
</dd>
<dt><code>base</code></dt>
<dd>Base OU to search for users.
</dd>
<dt><code>ssl</code></dt>
<dd>LDAP encryption method. Options are <code>simple_tls</code>, <code>start_tls</code>, or <code>false</code> to disable LDAPS. See the <a href="http://www.rubydoc.info/github/ruby-ldap/ruby-net-ldap/Net/LDAP:encryption">Net:LDAP Rubydoc</a>
</dd>
</dl>
<h4 id="ldap-configuration-example"><a href="#ldap-configuration-example">LDAP Configuration Example</a></h4>
<p><strong><code>config/ldap.yml</code></strong></p>
<pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="fu">authorizations:</span> <span class="dt">&amp;AUTHORIZATIONS</span>
  <span class="fu">group_base:</span> cn=users,dc=example,dc=com
  <span class="fu">required_groups:</span>
   <span class="kw">-</span> <span class="kw">[</span>“member”<span class="kw">,</span> “cn=app_users<span class="kw">,</span>cn=users<span class="kw">,</span>dc=example<span class="kw">,</span>dc=com”<span class="kw">]</span>
  <span class="fu">admin_group:</span> cn=app_admins,cn=users,dc=example,dc=com

production
  <span class="fu">host:</span> ldap.example.com
  <span class="fu">port:</span> 389
  <span class="fu">attribute:</span> samaccountname
  <span class="fu">base:</span> cn=users,dc=example,dc=com
  <span class="fu">admin_user:</span> cn=app_bind,cn=users,dc=example,dc=com
  <span class="fu">admin_password:</span> secret
  <span class="fu">ssl:</span> false
  <span class="fu">&lt;&lt;:</span> <span class="dt">*AUTHORIZATIONS</span></code></pre>
<h3 id="set-up-database"><a href="#set-up-database">Set up Database</a></h3>
<p>Run the script <code>install/setupdb.sh</code> to initialise the database.<br />Ensure that LDAP settings are configured and the LDAP server is available before running the script.</p>
<h3 id="configuring-https"><a href="#configuring-https">Configuring HTTPS</a></h3>
<p>Using HTTPS is recommended, but not required. If you installed FM with the installer, a self-signed SSL certificate was created for you, and FM will use this for HTTPS.<br /><a href="#restarting-fleet-manager">Restart</a> the application after making any changes to the configuration file.</p>
<h4 id="using-your-own-ssl-certificate"><a href="#using-your-own-ssl-certificate">Using your own SSL certificate</a></h4>
<p>To use your own SSL certificate, edit the configuration file <code>/etc/fm.sh</code> and update the following lines with the path to your SSL certificate.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">SSL_CERT=</span>/etc/ssl/certs/self-signed.pem
<span class="ot">SSL_KEY=</span>/etc/ssl/private/self-signed.key</code></pre>
<h4 id="disabling-https"><a href="#disabling-https">Disabling HTTPS</a></h4>
<p>To serve the application over HTTP instead of HTTPS, edit the configuration file <code>/etc/fm.sh</code> and change the value of <code>SSL</code> to <code>false</code>.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">SSL=</span>false</code></pre>
<p>Set the port to 80.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">PORT=</span>80</code></pre>
<h2 id="maintaining-fleet-manager"><a href="#maintaining-fleet-manager">Maintaining Fleet Manager</a></h2>
<p>The Fleet Manager service can be controlled from the initscript <code>/etc/init.d/fm</code>.</p>
<h3 id="starting-fleet-manager"><a href="#starting-fleet-manager">Starting Fleet Manager</a></h3>
<p>To start the FM service:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> /etc/init.d/fm start</code></pre>
<p>You will see a message like the following. Note that this contains useful info such as the address the web server is listening on and log file location.</p>
<pre><code>Starting service…
=============== Phusion Passenger Standalone web server started ===============
PID file: /var/run/fm.pid
Log file: /var/log/fm.log
Environment: production
Accessible via: https://0.0.0.0:443/

Serving in the background as a daemon.
Problems? Check https://www.phusionpassenger.com/library/admin/standalone/troubleshooting/
===============================================================================
Service started</code></pre>
<p>The first time you start FM, Phusion Passenger will download and set up a web server module for your system. You will see a message like</p>
<pre><code> --&gt; Downloading a Phusion Passenger agent binary for your platform

 --&gt; Installing Nginx 1.8.0 engine

--------------------------

 --&gt; Compiling passenger_native_support.so for the current Ruby interpreter...
     (set PASSENGER_COMPILE_NATIVE_SUPPORT_BINARY=0 to disable)
     Compilation succesful. The logs are here:
     /tmp/passenger_native_support-1e4sumo.log
 --&gt; passenger_native_support.so successfully loaded.</code></pre>
<h3 id="stopping-fleet-manager"><a href="#stopping-fleet-manager">Stopping Fleet Manager</a></h3>
<p>To stop the FM service:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> /etc/init.d/fm stop</code></pre>
<pre><code>Stopping service…
Service stopped</code></pre>
<h3 id="restarting-fleet-manager"><a href="#restarting-fleet-manager">Restarting Fleet Manager</a></h3>
<p>To restart FM:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> /etc/init.d/fm restart</code></pre>
<p>This is the same as running the <code>stop</code> and <code>start</code> actions successively.<br />If FM is already stopped, this action is the same as <code>start</code>.</p>
<h3 id="checking-if-fleet-manager-is-running"><a href="#checking-if-fleet-manager-is-running">Checking if Fleet Manager is running</a></h3>
<p>To determine if the FM service is running:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> /etc/init.d/fm status</code></pre>
<p>If it is running, its PID and PID file will be reported.</p>
<pre><code>Phusion Passenger Standalone is running on PID 25279, according to PID file /var/run/fm.pid</code></pre>
<p>You will see this message if it is not running.</p>
<pre><code>Phusion Passenger Standalone is not running, according to PID file /var/run/fm.pid</code></pre>
<h3 id="backing-up-fleet-manager"><a href="#backing-up-fleet-manager">Backing up Fleet Manager</a></h3>
<p>To back up Fleet Manager’s data, <a href="#stopping-fleet-manager">stop</a> the application, then copy the database file to a backup location.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> /etc/init.d/fm stop
<span class="kw">sudo</span> cp /srv/rails/fm/db/production.sqlite3 /path/to/backups/production_backup.sqlite3
<span class="kw">sudo</span> /etc/init.d/fm start</code></pre>
<h3 id="restoring-from-backup"><a href="#restoring-from-backup">Restoring from backup</a></h3>
<p>To restore from a backup, <a href="#stopping-fleet-manager">stop</a> the application, then copy the backup to <code>db/production.sqlite3</code> under the app directory.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> /etc/init.d/fm stop
<span class="kw">sudo</span> cp /path/to/backups/production_backup.sqlite3 /srv/rails/fm/db/production.sqlite3
<span class="kw">sudo</span> /etc/init.d/fm start</code></pre>
<p>If you are restoring to a new installation, restore the database in place of performing the <a href="#set-up-database">Set up database</a> step.</p>
<h2 id="uninstalling-fleet-manager"><a href="#uninstalling-fleet-manager">Uninstalling Fleet Manager</a></h2>
<p>If you need to retain your Car, Trip and user data, <a href="#backing-up-fleet-manager">backup the database</a> before uninstalling.</p>
<h3 id="uninstalling-fleet-manager-with-the-uninstaller"><a href="#uninstalling-fleet-manager-with-the-uninstaller">Uninstalling Fleet Manager with the uninstaller</a></h3>
<p>If you installed FM <a href="#installing-fleet-manager-with-the-installer">with the installer</a>, you can use the uninstaller to remove it.<br />The uninstaller is a script which does the following:</p>
<ul>
<li>Warns you able what it will do.</li>
<li>Prompts you to continue.</li>
<li>Stops the FM service.</li>
<li>Optionally backs up the database.</li>
<li>Deletes the SSL certificate the installer generated.</li>
<li>Deletes the initscript</li>
<li>Deletes the app directory</li>
</ul>
<p>To uninstall Fleet Manager:</p>
<ol style="list-style-type: decimal">
<li><p>Copy the script to your home directory and run it.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cp</span> /srv/rails/fm/install/uninstall.sh .
<span class="kw">chmod</span> +x uninstall.sh
<span class="kw">./uninstall.sh</span></code></pre></li>
<li><p>Read the warning. Type <em>1</em> to continue with the uninstaller, or <em>2</em> to exit.</p></li>
</ol>
<pre><code>###########
#         #
# WARNING #
#         #
###########

This script will delete the following files and directories:
/etc/fm.sh
/etc/init.d/fm
/etc/ssl/certs/self-signed.key
/etc/ssl/certs/self-signed.pem
/srv/rails/fm

Are you sure you want to uninstall Fleet Manager?
1) Yes
2) No
#?</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>The size of the database and backup target are displayed. Type <em>1</em> to backup the database to your home directory, <em>2</em> to continue without making a backup, and <em>3</em> to exit the uninstaller.</li>
</ol>
<pre><code>Backup database (Size 24K) to /home/ben/fm-production-backup_1439893245.sqlite3 ?
Select Cancel to exit the uninstaller.&quot;
1) Yes
2) No
3) Cancel
#?</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>You will be prompted for your sudo password, uninstaller will run.</li>
<li>The uninstaller will suggest some other tasks you may want to complete manually. See <a href="#uninstalling-fleet-manager-manually">Uninstalling Fleet Manager manually</a> for details.</li>
</ol>
<h3 id="uninstalling-fleet-manager-manually"><a href="#uninstalling-fleet-manager-manually">Uninstalling Fleet Manager manually</a></h3>
<p>If you installed FM <a href="#installing-fleet-manager-manually">manually</a> or would prefer not to use the uninstaller, use this process to remove it.</p>
<ol style="list-style-type: decimal">
<li><a href="#stopping-fleet-manager">Stop</a> the FM service.</li>
<li><p>Remove the user <code>fm</code> if it is no longer required by another application.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> userdel fm</code></pre></li>
<li><p>Remove the app directory</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> rm -rf /srv/rails/fm</code></pre></li>
<li><p>Uninstall passenger and bundler if they are no longer required by another application.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> gem uninstall bundler
<span class="kw">sudo</span> gem uninstall passenger</code></pre></li>
<li><p>Remove the initscript and config file.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> rm /etc/init.d/fm
<span class="kw">sudo</span> rm /etc/fm.sh</code></pre></li>
<li><p>Remove the SSL certificate and key if they are no longer required by another application. E.g.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> rm /etc/ssl/certs/self-signed.pem
<span class="kw">sudo</span> rm /etc/ssl/private/self-signed.key</code></pre></li>
<li><p>Uninstall any prerequisite software which is no longer required. E.g.</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> apt-get remove ruby-dev zlib1g-dev libsqlite3-dev openssl git</code></pre></li>
</ol>
<h2 id="troubleshooting"><a href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="log-files"><a href="#log-files">Log files</a></h3>
<p>Fleet Manager’s log is <code>log/production.log</code> under the app directory. This will show what the application is doing, such as receiving HTTP requests and making database queries. Passenger has a separate log file <code>/var/log/fm.log</code>. This will show what the Passenger service is doing, such as starting and stopping the application.</p>
<h3 id="troubleshooting-running-application"><a href="#troubleshooting-running-application">Troubleshooting running application</a></h3>
<h4 id="web-page-loads-but-looks-strange"><a href="#web-page-loads-but-looks-strange">Web page loads but looks strange</a></h4>
<p><strong>Symptoms:</strong> Web pages use browser default style, no images or styles are loaded.<br />If you attempt to sign out, you see a 404 error page.<br />You may see log messages such as:</p>
<pre><code>I, [2015-08-17T18:33:44.049755 #29405]  INFO -- : Started GET &quot;/javascripts/application.js&quot; for 192.168.1.26 at 2015-08-17 18:33:44 +1000
F, [2015-08-17T18:33:44.066944 #29405] FATAL -- :
ActionController::RoutingError (No route matches [GET] &quot;/javascripts/application.js&quot;):


I, [2015-08-17T18:34:15.734383 #29405]  INFO -- : Started GET &quot;/users/sign_out&quot; for 192.168.1.26 at 2015-08-17 18:34:15 +1000
F, [2015-08-17T18:34:15.741476 #29405] FATAL -- :
ActionController::RoutingError (No route matches [GET] &quot;/users/sign_out&quot;):</code></pre>
<p><strong>Resolution:</strong> The web server is not serving static files. Use <code>rake</code> to prepare the files to be deliverd to clients</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">RAILS_ENV=</span>production <span class="kw">bundle</span> exec rake assets:precompile</code></pre>
<h1 id="using-fleet-manager"><a href="#using-fleet-manager">Using Fleet Manager</a></h1>
<h2 id="navigating-fleet-manager"><a href="#navigating-fleet-manager">Navigating Fleet Manager</a></h2>
<p>At the bottom of each page are links to the main pages, <strong>Cars</strong>, <strong>Trips</strong>, and <strong>Reports</strong>.<br />Each page also has a sign out link.</p>
<h3 id="signing-in-to-fleet-manager"><a href="#signing-in-to-fleet-manager">Signing in to Fleet Manager</a></h3>
<p>To Sign in to Fleet Manager, you will need your directory account username and password. This account should be a member of the FM users group, see <a href="#configuring-ldap">Configuring LDAP</a>.</p>
<p>In a web browser, browse to Fleet Manager’s address. At the <strong>Sign In</strong> page, enter your username and password and click <em>Sign in</em>.</p>
<p> <img src="images/sign-in.png" alt="Sign In page" /></p>
<p>After signing in, you will be redirected to the <strong>Cars</strong> page.</p>
<p> <img src="images/cars-empty.png" alt="Cars page" /></p>
<h3 id="logging-out-of-fleet-manager"><a href="#logging-out-of-fleet-manager">Logging out of Fleet Manager</a></h3>
<p>To sign out of Fleet Manager, click the <em>Sign out user name</em> link at the bottom of any page. Your session will end and you will be redirected to the <strong>Sign In</strong> page.</p>
<h2 id="managing-cars"><a href="#managing-cars">Managing cars</a></h2>
<h3 id="adding-a-car"><a href="#adding-a-car">Adding a car</a></h3>
<p>At the <strong>Cars</strong> page, click <em>Add new car</em>.<br />Fill in the form with the details of the car and click <em>Create Car</em>.</p>
<p> <img src="images/new-car-form.png" alt="Completed new car form" /></p>
<p>If one of fields is blank or entered incorrectly, you will see a message such as the following.</p>
<p> <img src="images/new-car-form-blank-name.png" alt="Car form with blank name" /></p>
<p>Cars are listed on the <strong>Cars</strong> page with their name and an icon. If Fleet Manager has a logo image for a car’s <em>Make</em>, it will be displayed as the icon.</p>
<h3 id="viewing-a-cars-details"><a href="#viewing-a-cars-details">Viewing a car’s details</a></h3>
<p>At the <strong>Cars</strong> page, click the name or image of a car to browse to its <strong>car details</strong> page. This page shows the car’s details.</p>
<p> <img src="images/car-company-car.png" alt="Car details page" /></p>
<p>To see disabled cars, click <em>Show inactive cars</em> on the <strong>Cars</strong> page to switch to the disabled cars view.<br />Click <em>Show active cars</em> to return to the standard view.</p>
<h3 id="editing-a-car"><a href="#editing-a-car">Editing a car</a></h3>
<p>To change a car’s details, click <em>Edit car</em> from the <a href="#viewing-a-cars-details">car details page</a>.<br />You can update details that were set when creating the car. Click <em>Update Car</em> to save changes.</p>
<h3 id="disabling-a-car."><a href="#disabling-a-car.">Disabling a car.</a></h3>
<p>When a car is no longer in use, disable it by <a href="#editing-a-car">editing</a> it and clearing the <em>Enable</em> check box.<br />This will hide the car from the default view. There is no option to remove cars from the database.</p>
<h2 id="logging-travel"><a href="#logging-travel">Logging travel</a></h2>
<p>To record a journey, click <em>Log trip</em> under the car’s name on the <strong>Cars</strong> page, or <em>Log new trip for car name</em> from it’s <strong>car details</strong> page or <strong>Trips</strong> page.</p>
<p>Enter the location and odometer reading as at the end of the trip and click <em>Create Trip</em>.</p>
<p> <img src="images/new-trip-form.png" alt="Completed new trip form" /></p>
<p>When entering a location, you can search previously used location by entering part of their name. a suggestion box will appear with matching locations. Click one of these suggestions to copy it to the location field.</p>
<p> <img src="images/new-trip-form-suggestion.png" alt="Location suggestion" /></p>
<h3 id="logging-garaged-cars"><a href="#logging-garaged-cars">Logging garaged cars</a></h3>
<p>If the trip ends at an [employee’s residence](#garaging-cars] and will stay there overnight, check the <em>Garaged</em> checkbox when completing the form.</p>
<h3 id="logging-personal-travel"><a href="#logging-personal-travel">Logging personal travel</a></h3>
<p>If the trip is <a href="#personal-travel">not for business purposes</a>, check the <em>Personal</em> checkbox when completing the form.</p>
<h2 id="viewing-trips"><a href="#viewing-trips">Viewing trips</a></h2>
<p>The <strong>Trips</strong> page shows a table of all trips.<br />To view trips for a single car, click that car’s name in the <em>Car</em> column.</p>
<p> <img src="images/trips.png" alt="Trips page" /></p>
<h2 id="reports"><a href="#reports">Reports</a></h2>
<p>The <strong>Reports</strong> page shows a list of available reports. Click the name of a report to see it.<br />On the report page, click <em>Download CSV</em> for a copy of the report data in CSV format.</p>
<p> <img src="images/distance-per-driver-report.png" alt="Distance per driver report" /></p>
</body>
</html>
